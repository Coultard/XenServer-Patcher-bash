{"name":"Xenserver-patcher-bash","tagline":"Simple bash script for Xen Server 6.2 that will download the patches xml, sort by time, check if the patch was installed already, downloades and install new ones.","body":"### Welcome to xeer1update.\r\n\r\nSince the release of 6.2 I have been struggling to keep my server updated. The first time I had to manually apply 4 patches and the seconds time I had about 6. I decided to make my own little upgrade script.\r\nBelow is xeer1update\r\n\r\n```bash\r\n#!/bin/bash\r\n#Automatically Update script for Xen Servers. Supports only 6.2 at the moment.\r\n#Start by downloading the xml file\r\n#bash xeer1\r\necho \"Downloading updates.xml\"\r\ncurl -# -L -R -o updates.xml http://updates.xensource.com/XenServer/updates.xml\r\n\r\n#Grep the patches for version number XS62E, parse the data, and form the table\r\n#Columns are 1-patch name 2 - url 3- timestamp and 4- uuid\r\n#Each column is one variable and sorted by date and then by name\r\n#the below stopped working. I was notified on July 19th 2014\r\ngrep 'name-label=\"XS62E' updates.xml | cut -d \"\\\"\" -f 2,4,8,16 --output-delimiter=\" \"|sort -k3,3 -k4|while read line4 line2 line3 line1\r\n        do\r\n        #Save some typing\r\n        export ShortUrl=`basename $line2`\r\n                # Check to see if the patch has been installed already\r\n                if [[ -n $(xe patch-list name-label=$line1 2> /dev/null) ]]\r\n                then\r\n                        echo $line1 \"has aleady been installed\"\r\n                else\r\n                        #Patch download portion\r\n                        echo -e $line1 \"Patch was not found.\\nRetrieving URL for download \" $line2 \" \\nURL Fetched Starting Download\"\r\n                                #check to see if the file already exists\r\n                                if [ -f $ShortUrl ]\r\n                                then\r\n                                        #skips the file\r\n                                        echo $ShortUrl \" already exists skipping download\\n\"\r\n                                else\r\n                                        #Downloads the file and unzip it\r\n                                        echo \"Downloading $ShortUrl\"\r\n                                        curl -# -o $ShortUrl -L -R $line2\r\n                                        echo -e \"Download Completed\\n\"\r\n\r\n                                fi\r\n                        #Unzip\r\n                        echo -e \"Unziping \" $ShortUrl \"\\n\"\r\n                        unzip -o -q $ShortUrl\r\n                        #upload to Xen Server\r\n                        echo \"Uploading to Xen Server\"\r\n                        xe patch-upload file-name=$line1.xsupdate\r\n                        echo \"Applying Patch\"\r\n                        xe patch-pool-apply uuid=$line4\r\n                        echo \"Verifying Installation\"\r\n                                if [[ -n $(xe patch-list name-label=$line1 2> /dev/null) ]]\r\n                                        then\r\n#Removing src xsupdate and cleaning with patch clean\r\n                                                echo $line1 \"has been installed successfully\"\r\n                                                echo \"Removing installation files\"\r\n                                                rm -f $line1-src-pkgs.tar.bz2\r\n                                                rm -f $line1.xsupdate\r\nxe patch-clean uuid=$line4\r\n                                        else\r\n                                                echo $line1 \"Failed to Install please check it manually. Please fix the issue and run this program again\"\r\n                                                #Remove patch for you to fix the issue and try again\r\n                                                rm -rf /opt/xensource/patch-backup/$line3\r\n                                                exit 0\r\n                                fi\r\n                fi\r\n        done\r\n```\r\n\r\nFeel free to use it in any way you want.\r\n\r\nI did some testing on a couple of 6.2 installations and as long as you ave enough disk space you should not see any errors.\r\n\r\nHave fun.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}